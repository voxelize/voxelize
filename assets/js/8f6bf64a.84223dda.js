"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2928],{43023:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var i=n(63696);const s={},a=i.createContext(s);function r(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:t},e.children)}},87903:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"intermediate/the-client-entity","title":"The Client Entity","description":"On the client side, entities are Three.js objects that represent server-side ECS entities. They receive data updates from the server and render accordingly.","source":"@site/docs/tutorials/intermediate/2-the-client-entity.md","sourceDirName":"intermediate","slug":"/intermediate/the-client-entity","permalink":"/tutorials/intermediate/the-client-entity","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Entity Component System","permalink":"/tutorials/intermediate/entity-component-system"},"next":{"title":"Custom Entity Creation","permalink":"/tutorials/intermediate/custom-entity-creation"}}');var s=n(62540),a=n(43023);const r={sidebar_position:2},o="The Client Entity",d={},l=[{value:"The Entity Base Class",id:"the-entity-base-class",level:2},{value:"Lifecycle Hooks",id:"lifecycle-hooks",level:2},{value:"Registering Entity Classes",id:"registering-entity-classes",level:2},{value:"Position Interpolation",id:"position-interpolation",level:2},{value:"Using Characters for Entities",id:"using-characters-for-entities",level:2},{value:"Extending with Mixins",id:"extending-with-mixins",level:2},{value:"Loading 3D Models",id:"loading-3d-models",level:2},{value:"Debug Visualization",id:"debug-visualization",level:2},{value:"Custom Entities Manager",id:"custom-entities-manager",level:2},{value:"Adding Entities to the Scene",id:"adding-entities-to-the-scene",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"the-client-entity",children:"The Client Entity"})}),"\n",(0,s.jsx)(t.p,{children:"On the client side, entities are Three.js objects that represent server-side ECS entities. They receive data updates from the server and render accordingly."}),"\n",(0,s.jsx)(t.h2,{id:"the-entity-base-class",children:"The Entity Base Class"}),"\n",(0,s.jsxs)(t.p,{children:["Every client entity extends ",(0,s.jsx)(t.code,{children:"VOXELIZE.Entity<T>"}),", where ",(0,s.jsx)(t.code,{children:"T"})," is the type of data received from the server:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Basic Entity Structure"',children:'import * as VOXELIZE from "@voxelize/core";\nimport * as THREE from "three";\n\ntype MyEntityData = {\n  position: VOXELIZE.Coords3;\n  health: number;\n};\n\nclass MyEntity extends VOXELIZE.Entity<MyEntityData> {\n  constructor(id: string) {\n    super(id);\n\n    this.add(\n      new THREE.Mesh(\n        new THREE.BoxGeometry(1, 1, 1),\n        new THREE.MeshStandardMaterial({ color: 0xff0000 })\n      )\n    );\n  }\n\n  onCreate = (data: MyEntityData) => {\n    this.position.set(...data.position);\n  };\n\n  onUpdate = (data: MyEntityData) => {\n    this.position.set(...data.position);\n  };\n\n  onDelete = () => {\n    // Cleanup resources if needed\n  };\n\n  update = () => {\n    // Called each frame for animations\n  };\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"lifecycle-hooks",children:"Lifecycle Hooks"}),"\n",(0,s.jsx)(t.p,{children:"Entities have four lifecycle hooks:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Hook"}),(0,s.jsx)(t.th,{children:"When Called"}),(0,s.jsx)(t.th,{children:"Purpose"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"onCreate"})}),(0,s.jsx)(t.td,{children:"Entity first appears"}),(0,s.jsx)(t.td,{children:"Initial setup, position, spawn effects"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"onUpdate"})}),(0,s.jsx)(t.td,{children:"Server sends new data"}),(0,s.jsx)(t.td,{children:"Update position, state, animations"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"onDelete"})}),(0,s.jsx)(t.td,{children:"Entity removed"}),(0,s.jsx)(t.td,{children:"Cleanup, despawn effects"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"update"})}),(0,s.jsx)(t.td,{children:"Every animation frame"}),(0,s.jsx)(t.td,{children:"Continuous animations, interpolation"})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"registering-entity-classes",children:"Registering Entity Classes"}),"\n",(0,s.jsxs)(t.p,{children:["Register your entity class with the ",(0,s.jsx)(t.code,{children:"Entities"})," manager:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Entity Registration"',children:'const entities = new VOXELIZE.Entities();\n\nentities.setClass("my-entity", MyEntity);\n\nnetwork.register(entities);\n'})}),"\n",(0,s.jsxs)(t.p,{children:["The type string must match the server's ",(0,s.jsx)(t.code,{children:"ETypeComp"})," (case-insensitive)."]}),"\n",(0,s.jsx)(t.h2,{id:"position-interpolation",children:"Position Interpolation"}),"\n",(0,s.jsxs)(t.p,{children:["For smooth movement, interpolate positions in ",(0,s.jsx)(t.code,{children:"onUpdate"})," and ",(0,s.jsx)(t.code,{children:"update"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Smooth Position Updates"',children:"class SmoothEntity extends VOXELIZE.Entity<{ position: VOXELIZE.Coords3 }> {\n  private targetPosition = new THREE.Vector3();\n\n  onUpdate = (data: { position: VOXELIZE.Coords3 }) => {\n    this.targetPosition.set(...data.position);\n  };\n\n  update = () => {\n    this.position.lerp(this.targetPosition, 0.1);\n  };\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"using-characters-for-entities",children:"Using Characters for Entities"}),"\n",(0,s.jsxs)(t.p,{children:["For humanoid entities, use ",(0,s.jsx)(t.code,{children:"VOXELIZE.Character"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Character-Based Entity"',children:'import * as VOXELIZE from "@voxelize/core";\n\ntype BotData = {\n  position: VOXELIZE.Coords3;\n  direction: number[];\n};\n\nclass Bot extends VOXELIZE.Entity<BotData> {\n  public character: VOXELIZE.Character;\n\n  constructor(id: string) {\n    super(id);\n\n    this.character = new VOXELIZE.Character({\n      nameTagOptions: {\n        fontFace: "monospace",\n        yOffset: 0.2,\n      },\n    });\n    this.add(this.character);\n  }\n\n  onCreate = (data: BotData) => {\n    this.character.set(data.position, data.direction);\n  };\n\n  onUpdate = (data: BotData) => {\n    this.character.set(data.position, data.direction);\n  };\n\n  update = () => {\n    this.character.update();\n  };\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"extending-with-mixins",children:"Extending with Mixins"}),"\n",(0,s.jsx)(t.p,{children:"Use mixins to add reusable functionality:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Mixin Pattern"',children:'export const HoldingMixin = <\n  T extends new (...args: any[]) => VOXELIZE.Character\n>(\n  Base: T\n) => {\n  return class extends Base {\n    public holdingObjectId = 0;\n\n    setHoldingObjectId = (id: number, world?: VOXELIZE.World) => {\n      if (id === this.holdingObjectId) return;\n\n      const mesh = world?.makeBlockMesh(id, { material: "basic" });\n      this.setArmHoldingObject(mesh);\n      this.holdingObjectId = id;\n    };\n  };\n};\n\nclass HoldingCharacter extends HoldingMixin(VOXELIZE.Character) {}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"loading-3d-models",children:"Loading 3D Models"}),"\n",(0,s.jsx)(t.p,{children:"For entities with custom 3D models:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Model-Based Entity"',children:'import * as VOXELIZE from "@voxelize/core";\nimport * as THREE from "three";\nimport { GLTFLoader } from "three/examples/jsm/loaders/GLTFLoader.js";\n\ntype ModelData = {\n  position: VOXELIZE.Coords3;\n  rotation: number[];\n  modelUrl: string;\n};\n\nclass ModelEntity extends VOXELIZE.Entity<ModelData> {\n  private loader = new GLTFLoader();\n  private model: THREE.Object3D | null = null;\n  private targetPosition = new THREE.Vector3();\n  private targetRotation = new THREE.Euler();\n\n  onCreate = (data: ModelData) => {\n    this.targetPosition.set(...data.position);\n    this.position.copy(this.targetPosition);\n\n    this.loader.load(data.modelUrl, (gltf) => {\n      this.model = gltf.scene;\n      this.add(this.model);\n    });\n  };\n\n  onUpdate = (data: ModelData) => {\n    this.targetPosition.set(...data.position);\n    this.targetRotation.set(\n      data.rotation[0],\n      data.rotation[1],\n      data.rotation[2]\n    );\n  };\n\n  update = () => {\n    this.position.lerp(this.targetPosition, 0.1);\n    this.rotation.x += (this.targetRotation.x - this.rotation.x) * 0.1;\n    this.rotation.y += (this.targetRotation.y - this.rotation.y) * 0.1;\n    this.rotation.z += (this.targetRotation.z - this.rotation.z) * 0.1;\n  };\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"debug-visualization",children:"Debug Visualization"}),"\n",(0,s.jsx)(t.p,{children:"Add debug helpers to visualize entity state:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Debug Helpers"',children:"class DebugBot extends VOXELIZE.Entity<BotData> {\n  private pathLine: THREE.Line | null = null;\n\n  onUpdate = (data: BotData & { path?: VOXELIZE.Coords3[] }) => {\n    if (data.path && data.path.length > 0) {\n      this.updatePathVisualization(data.path);\n    }\n  };\n\n  private updatePathVisualization(path: VOXELIZE.Coords3[]) {\n    if (this.pathLine) {\n      this.remove(this.pathLine);\n    }\n\n    const points = path.map(\n      (p) => new THREE.Vector3(p[0] + 0.5, p[1] + 0.5, p[2] + 0.5)\n    );\n    const geometry = new THREE.BufferGeometry().setFromPoints(points);\n    const material = new THREE.LineBasicMaterial({ color: 0x00ff00 });\n    this.pathLine = new THREE.Line(geometry, material);\n    this.add(this.pathLine);\n  }\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"custom-entities-manager",children:"Custom Entities Manager"}),"\n",(0,s.jsxs)(t.p,{children:["Extend the base ",(0,s.jsx)(t.code,{children:"Entities"})," class for additional functionality:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Custom Entities Manager"',children:'import * as VOXELIZE from "@voxelize/core";\nimport { EntityProtocol } from "@voxelize/protocol";\n\nclass GameEntities extends VOXELIZE.Entities {\n  public lastEntity: EntityProtocol<any> | null = null;\n\n  onEntity = (entity: EntityProtocol<any>) => {\n    this.lastEntity = entity;\n\n    if (entity.type === "scoreboard") {\n      this.handleScoreboard(entity);\n    }\n  };\n\n  private handleScoreboard(entity: EntityProtocol<any>) {\n    // Handle scoreboard updates\n  }\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"adding-entities-to-the-scene",children:"Adding Entities to the Scene"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"Entities"})," manager is a Three.js ",(0,s.jsx)(t.code,{children:"Group"}),". Add it to your world:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Adding to Scene"',children:'const entities = new VOXELIZE.Entities();\n\nentities.setClass("bot", Bot);\nentities.setClass("drop", Drop);\n\nnetwork.register(entities);\n\nworld.add(entities);\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Call ",(0,s.jsx)(t.code,{children:"update()"})," in your render loop:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Render Loop"',children:"function animate() {\n  requestAnimationFrame(animate);\n\n  entities.update();\n\n  renderer.render(scene, camera);\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Read on to learn about ",(0,s.jsx)(t.a,{href:"./custom-entity-creation",children:"creating entities on the server"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);