"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2591],{43023:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var i=n(63696);const a={},s=i.createContext(a);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:t},e.children)}},52831:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"entities/custom-entities","title":"Custom Entities","description":"Entities are server-controlled objects that sync to clients - mobs, NPCs, projectiles, or any game object that needs authoritative state.","source":"@site/docs/wiki/entities/custom-entities.md","sourceDirName":"entities","slug":"/entities/custom-entities","permalink":"/wiki/entities/custom-entities","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Entities","permalink":"/wiki/category/entities"},"next":{"title":"Custom Peers","permalink":"/wiki/entities/custom-peers"}}');var a=n(62540),s=n(43023);const r={sidebar_position:1},o="Custom Entities",l={},d=[{value:"Example: Bot Entity",id:"example-bot-entity",level:2},{value:"Server: Define the Entity Loader",id:"server-define-the-entity-loader",level:3},{value:"Server: Spawn via Method",id:"server-spawn-via-method",level:3},{value:"Client: Define the Entity Class",id:"client-define-the-entity-class",level:3},{value:"Client: Register and Use",id:"client-register-and-use",level:3},{value:"Entity Lifecycle",id:"entity-lifecycle",level:2},{value:"Full Client Implementation",id:"full-client-implementation",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"custom-entities",children:"Custom Entities"})}),"\n",(0,a.jsx)(t.p,{children:"Entities are server-controlled objects that sync to clients - mobs, NPCs, projectiles, or any game object that needs authoritative state."}),"\n",(0,a.jsx)(t.h2,{id:"example-bot-entity",children:"Example: Bot Entity"}),"\n",(0,a.jsx)(t.p,{children:"This example creates a bot that follows players around the world."}),"\n",(0,a.jsx)(t.mermaid,{value:'sequenceDiagram\n    participant Server\n    participant Client\n\n    Server->>Server: spawn_entity("bot", position)\n    Server->>Client: ENTITY CREATE\n    Client->>Client: new Bot() + onCreate()\n\n    loop Every tick\n        Server->>Server: AI pathfinding + movement\n        Server->>Client: ENTITY UPDATE (position, direction)\n        Client->>Client: onUpdate() + interpolate\n    end\n\n    Server->>Server: despawn_entity(id)\n    Server->>Client: ENTITY DELETE\n    Client->>Client: onDelete()'}),"\n",(0,a.jsx)(t.h3,{id:"server-define-the-entity-loader",children:"Server: Define the Entity Loader"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",metastring:'title="Server Entity Definition"',children:'use voxelize::*;\nuse specs::Component;\nuse nanoid::nanoid;\nuse std::time::Duration;\n\n#[derive(Component, Default)]\n#[storage(NullStorage<BotFlag>)]\nstruct BotFlag;\n\nworld.set_entity_loader("bot", |world, metadata| {\n    let body = RigidBody::new(\n        &AABB::new().scale_x(0.6).scale_y(1.8).scale_z(0.6).build()\n    );\n    let interactor = world.physics_mut().register(&body);\n\n    world\n        .create_entity(&nanoid!(), "bot")\n        .with(BotFlag)\n        .with(PositionComp::default())\n        .with(DirectionComp::default())\n        .with(RigidBodyComp::new(&body))\n        .with(InteractorComp::new(&interactor))\n        .with(BrainComp::new(BrainOptions {\n            max_speed: 4.0,\n            jump_impulse: 8.0,\n            ..Default::default()\n        }))\n        .with(TargetComp::players())\n        .with(PathComp::new(\n            100,\n            24.0,\n            10000,\n            Duration::from_millis(50),\n        ))\n});\n'})}),"\n",(0,a.jsx)(t.h3,{id:"server-spawn-via-method",children:"Server: Spawn via Method"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",metastring:'title="Spawn Method Handler"',children:'#[derive(Serialize, Deserialize)]\nstruct SpawnBotPayload {\n    position: [f32; 3],\n}\n\nworld.set_method_handle("spawn-bot", |world, _client_id, payload| {\n    let data: SpawnBotPayload = serde_json::from_value(payload).unwrap();\n    let [x, y, z] = data.position;\n\n    world.spawn_entity_at("bot", &Vec3(x, y, z));\n});\n'})}),"\n",(0,a.jsx)(t.h3,{id:"client-define-the-entity-class",children:"Client: Define the Entity Class"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="Client Entity Class"',children:'import * as VOXELIZE from "@voxelize/core";\nimport * as THREE from "three";\n\ntype BotData = {\n  position: VOXELIZE.Coords3;\n  direction: number[];\n};\n\nclass Bot extends VOXELIZE.Entity<BotData> {\n  character: VOXELIZE.Character;\n\n  constructor(id: string) {\n    super(id);\n\n    this.character = new VOXELIZE.Character({\n      nameTagOptions: {\n        fontFace: "monospace",\n      },\n    });\n    this.character.username = "Bot";\n    this.character.head.paint("all", new THREE.Color("#4a90d9"));\n\n    this.add(this.character);\n  }\n\n  onCreate = (data: BotData) => {\n    this.character.set(data.position, data.direction);\n  };\n\n  onUpdate = (data: BotData) => {\n    this.character.set(data.position, data.direction);\n  };\n\n  onDelete = () => {\n    this.character.dispose();\n  };\n\n  update = () => {\n    this.character.update();\n  };\n}\n'})}),"\n",(0,a.jsx)(t.h3,{id:"client-register-and-use",children:"Client: Register and Use"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="Client Entity Registration"',children:'const entities = new VOXELIZE.Entities();\nconst method = new VOXELIZE.Method();\n\nnetwork.register(entities);\nnetwork.register(method);\n\nentities.setClass("bot", Bot);\nworld.add(entities);\n\ninputs.bind("KeyZ", () => {\n  method.call("spawn-bot", {\n    position: controls.object.position.toArray(),\n  });\n});\n\nfunction animate() {\n  if (world.isInitialized) {\n    entities.update();\n  }\n}\n'})}),"\n",(0,a.jsx)(t.h2,{id:"entity-lifecycle",children:"Entity Lifecycle"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Server"}),(0,a.jsx)(t.th,{children:"Client"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:'set_entity_loader("type", ...)'})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:'entities.setClass("type", Class)'})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:'spawn_entity_at("type", pos)'})}),(0,a.jsxs)(t.td,{children:[(0,a.jsx)(t.code,{children:"onCreate(data)"})," called"]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"ECS systems update components"}),(0,a.jsxs)(t.td,{children:[(0,a.jsx)(t.code,{children:"onUpdate(data)"})," called"]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"despawn_entity(id)"})}),(0,a.jsxs)(t.td,{children:[(0,a.jsx)(t.code,{children:"onDelete()"})," called"]})]})]})]}),"\n",(0,a.jsx)(t.h2,{id:"full-client-implementation",children:"Full Client Implementation"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="main.ts"',children:'import * as VOXELIZE from "@voxelize/core";\nimport * as THREE from "three";\n\ntype BotData = {\n  position: VOXELIZE.Coords3;\n  direction: number[];\n};\n\nclass Bot extends VOXELIZE.Entity<BotData> {\n  character: VOXELIZE.Character;\n\n  constructor(id: string) {\n    super(id);\n    this.character = new VOXELIZE.Character();\n    this.character.username = "Bot";\n    this.add(this.character);\n  }\n\n  onCreate = (data: BotData) => {\n    this.character.set(data.position, data.direction);\n  };\n\n  onUpdate = (data: BotData) => {\n    this.character.set(data.position, data.direction);\n  };\n\n  update = () => {\n    this.character.update();\n  };\n}\n\nconst network = new VOXELIZE.Network();\nconst entities = new VOXELIZE.Entities();\nconst method = new VOXELIZE.Method();\n\nnetwork.register(entities);\nnetwork.register(method);\n\nentities.setClass("bot", Bot);\n\nasync function start() {\n  await network.connect("http://localhost:4000");\n  await network.join("tutorial");\n\n  method.call("spawn-bot", { position: [0, 50, 0] });\n}\n\nstart();\n'})}),"\n",(0,a.jsxs)(t.p,{children:["See ",(0,a.jsx)(t.code,{children:"examples/client/src/main.ts"})," for a complete implementation with path visualization and multiple entity types."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);