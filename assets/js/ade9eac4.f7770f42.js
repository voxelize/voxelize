"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7769],{43023:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>o});var t=r(63696);const a={},i=t.createContext(a);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},44077:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/multiplayer-4c0ab66d7c85364874dc34078aa49150.png"},93784:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"basics/multiplayer","title":"Multiplayer","description":"Voxelize uses WebSockets for real-time multiplayer. The Peers class manages other players\' positions and renders their characters.","source":"@site/docs/tutorials/basics/14-multiplayer.md","sourceDirName":"basics","slug":"/basics/multiplayer","permalink":"/tutorials/basics/multiplayer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14},"sidebar":"tutorialSidebar","previous":{"title":"Set Perspectives","permalink":"/tutorials/basics/perspectives-and-visuals"},"next":{"title":"Intermediate","permalink":"/tutorials/category/intermediate"}}');var a=r(62540),i=r(43023);const s={sidebar_position:14},o="Multiplayer",c={},l=[{value:"Setting Up Peers",id:"setting-up-peers",level:2},{value:"Creating Peer Characters",id:"creating-peer-characters",level:2},{value:"Handling Peer Updates",id:"handling-peer-updates",level:2},{value:"Update Loop",id:"update-loop",level:2},{value:"Full Implementation",id:"full-implementation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"multiplayer",children:"Multiplayer"})}),"\n",(0,a.jsxs)(n.p,{children:["Voxelize uses WebSockets for real-time multiplayer. The ",(0,a.jsx)(n.code,{children:"Peers"})," class manages other players' positions and renders their characters."]}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-peers",children:"Setting Up Peers"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"const peers = new VOXELIZE.Peers(rigidControls.object);\n\nnetwork.register(peers);\nworld.add(peers);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"rigidControls.object"})," (the camera) is used to broadcast your position to other players."]}),"\n",(0,a.jsx)(n.h2,{id:"creating-peer-characters",children:"Creating Peer Characters"}),"\n",(0,a.jsx)(n.p,{children:"Define how to create a character mesh for each connected player:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"function createCharacter() {\n  const character = new VOXELIZE.Character();\n  return character;\n}\n\npeers.createPeer = createCharacter;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"handling-peer-updates",children:"Handling Peer Updates"}),"\n",(0,a.jsx)(n.p,{children:"When another player moves, update their character:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"peers.onPeerUpdate = (peer, data) => {\n  peer.set(data.position, data.direction);\n};\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"set"})," method smoothly interpolates the character to the new position and direction."]}),"\n",(0,a.jsx)(n.h2,{id:"update-loop",children:"Update Loop"}),"\n",(0,a.jsx)(n.p,{children:"Add peer updates to your animation loop:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"function animate() {\n  requestAnimationFrame(animate);\n\n  if (world.isInitialized) {\n    rigidControls.update();\n    peers.update();\n  }\n\n  renderer.render(world, camera);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:r(44077).A+"",width:"2560",height:"1440"})}),"\n",(0,a.jsx)(n.h2,{id:"full-implementation",children:"Full Implementation"}),"\n",(0,a.jsx)(n.p,{children:"Here's the complete multiplayer setup:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:'import * as VOXELIZE from "@voxelize/core";\nimport * as THREE from "three";\n\nconst canvas = document.getElementById("canvas");\n\nconst world = new VOXELIZE.World({\n  textureUnitDimension: 16,\n});\n\nconst camera = new THREE.PerspectiveCamera(\n  75,\n  window.innerWidth / window.innerHeight,\n  0.1,\n  3000\n);\n\nconst renderer = new THREE.WebGLRenderer({\n  antialias: true,\n  powerPreference: "high-performance",\n  canvas,\n});\nrenderer.setSize(window.innerWidth, window.innerHeight);\nrenderer.setPixelRatio(window.devicePixelRatio || 1);\nrenderer.outputColorSpace = THREE.SRGBColorSpace;\n\nconst network = new VOXELIZE.Network();\n\nconst inputs = new VOXELIZE.Inputs();\n\nconst rigidControls = new VOXELIZE.RigidControls(\n  camera,\n  renderer.domElement,\n  world,\n  {\n    initialPosition: [0, 40, 0],\n  }\n);\n\nrigidControls.connect(inputs);\n\nfunction createCharacter() {\n  const character = new VOXELIZE.Character();\n  return character;\n}\n\nconst peers = new VOXELIZE.Peers(rigidControls.object);\n\npeers.createPeer = createCharacter;\n\npeers.onPeerUpdate = (peer, data) => {\n  peer.set(data.position, data.direction);\n};\n\nnetwork.register(world);\nnetwork.register(peers);\n\nworld.add(peers);\n\nfunction animate() {\n  requestAnimationFrame(animate);\n\n  if (world.isInitialized) {\n    rigidControls.update();\n    peers.update();\n  }\n\n  renderer.render(world, camera);\n}\n\nasync function start() {\n  animate();\n\n  await network.connect("http://localhost:4000");\n  await network.join("tutorial");\n\n  await world.initialize();\n}\n\nstart();\n'})}),"\n",(0,a.jsxs)(n.p,{children:["For a more advanced example with custom peer metadata (like held items), see ",(0,a.jsx)(n.code,{children:"examples/client/src/main.ts"})," and the ",(0,a.jsx)(n.a,{href:"/wiki/entities/custom-peers",children:"Custom Peers"})," wiki page."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);