"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7769],{43023:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var r=t(63696);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},44077:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/multiplayer-4c0ab66d7c85364874dc34078aa49150.png"},93784:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"basics/multiplayer","title":"Multiplayer","description":"Add real-time multiplayer with the Peers class. It syncs player positions over WebSockets and renders their characters.","source":"@site/docs/tutorials/basics/14-multiplayer.md","sourceDirName":"basics","slug":"/basics/multiplayer","permalink":"/tutorials/basics/multiplayer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14},"sidebar":"tutorialSidebar","previous":{"title":"Perspectives and Visuals","permalink":"/tutorials/basics/perspectives-and-visuals"},"next":{"title":"Intermediate","permalink":"/tutorials/category/intermediate"}}');var a=t(62540),i=t(43023);const o={sidebar_position:14},s="Multiplayer",l={},c=[{value:"Setup Peers",id:"setup-peers",level:2},{value:"Create Peer Characters",id:"create-peer-characters",level:2},{value:"Add Peer Updates",id:"add-peer-updates",level:2},{value:"Full Implementation",id:"full-implementation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",mermaid:"mermaid",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"multiplayer",children:"Multiplayer"})}),"\n",(0,a.jsxs)(n.p,{children:["Add real-time multiplayer with the ",(0,a.jsx)(n.code,{children:"Peers"})," class. It syncs player positions over WebSockets and renders their characters."]}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant You\n    participant Server\n    participant OtherPlayer\n    \n    You->>Server: Position update\n    Server->>OtherPlayer: Your position\n    OtherPlayer->>Server: Position update\n    Server->>You: Other player's position\n    \n    Note over You,OtherPlayer: Peers automatically sync every frame"}),"\n",(0,a.jsx)(n.h2,{id:"setup-peers",children:"Setup Peers"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"const peers = new VOXELIZE.Peers(rigidControls.object);\n\nnetwork.register(peers);\nworld.add(peers);\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"rigidControls.object"})," is the camera - this tells Peers what position to broadcast to other players."]}),"\n",(0,a.jsx)(n.h2,{id:"create-peer-characters",children:"Create Peer Characters"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"peers.createPeer = createCharacter;\n\npeers.onPeerUpdate = (peer, data) => {\n  peer.set(data.position, data.direction);\n};\n"})}),"\n",(0,a.jsxs)(n.p,{children:["When another player joins, ",(0,a.jsx)(n.code,{children:"createPeer"})," is called to make their character. When they move, ",(0,a.jsx)(n.code,{children:"onPeerUpdate"})," receives their position."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"set"})," method smoothly interpolates the character to the new position."]}),"\n",(0,a.jsx)(n.h2,{id:"add-peer-updates",children:"Add Peer Updates"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"function animate() {\n  requestAnimationFrame(animate);\n\n  if (world.isInitialized) {\n    world.update(\n      camera.getWorldPosition(new THREE.Vector3()),\n      camera.getWorldDirection(new THREE.Vector3())\n    );\n\n    rigidControls.update();\n    voxelInteract.update();\n    perspectives.update();\n    lightShined.update();\n    shadows.update();\n    peers.update();\n  }\n\n  renderer.render(world, camera);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(44077).A+"",width:"2560",height:"1440"})}),"\n",(0,a.jsx)(n.p,{children:"Open multiple browser tabs and you'll see other players moving around."}),"\n",(0,a.jsx)(n.h2,{id:"full-implementation",children:"Full Implementation"}),"\n",(0,a.jsx)(n.p,{children:"The complete tutorial code with multiplayer:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:'import * as VOXELIZE from "@voxelize/core";\nimport * as THREE from "three";\n\nconst canvas = document.getElementById("canvas");\n\nconst world = new VOXELIZE.World({\n  textureUnitDimension: 16,\n});\n\nconst camera = new THREE.PerspectiveCamera(\n  75,\n  window.innerWidth / window.innerHeight,\n  0.1,\n  3000\n);\n\nconst renderer = new THREE.WebGLRenderer({\n  antialias: true,\n  powerPreference: "high-performance",\n  canvas,\n});\nrenderer.setSize(window.innerWidth, window.innerHeight);\nrenderer.setPixelRatio(window.devicePixelRatio || 1);\nrenderer.outputColorSpace = THREE.SRGBColorSpace;\n\nwindow.addEventListener("resize", () => {\n  camera.aspect = window.innerWidth / window.innerHeight;\n  camera.updateProjectionMatrix();\n  renderer.setSize(window.innerWidth, window.innerHeight);\n});\n\nconst network = new VOXELIZE.Network();\nnetwork.register(world);\n\nconst inputs = new VOXELIZE.Inputs();\n\nconst rigidControls = new VOXELIZE.RigidControls(\n  camera,\n  renderer.domElement,\n  world,\n  {\n    initialPosition: [0, 40, 0],\n  }\n);\n\nrigidControls.connect(inputs);\n\ninputs.bind("g", rigidControls.toggleGhostMode);\ninputs.bind("f", rigidControls.toggleFly);\n\nconst voxelInteract = new VOXELIZE.VoxelInteract(camera, world, {\n  highlightType: "outline",\n});\n\nworld.add(voxelInteract);\n\nconst perspectives = new VOXELIZE.Perspective(rigidControls, world);\nperspectives.connect(inputs);\n\nconst shadows = new VOXELIZE.Shadows(world);\nconst lightShined = new VOXELIZE.LightShined(world);\n\nfunction createCharacter() {\n  const character = new VOXELIZE.Character();\n  world.add(character);\n  lightShined.add(character);\n  shadows.add(character);\n  return character;\n}\n\nconst mainCharacter = createCharacter();\nrigidControls.attachCharacter(mainCharacter);\n\nconst peers = new VOXELIZE.Peers(rigidControls.object);\n\npeers.createPeer = createCharacter;\n\npeers.onPeerUpdate = (peer, data) => {\n  peer.set(data.position, data.direction);\n};\n\nnetwork.register(peers);\nworld.add(peers);\n\nlet holdingBlockType = 1;\n\ninputs.click("left", () => {\n  if (!voxelInteract.target) return;\n  const [x, y, z] = voxelInteract.target;\n  world.updateVoxel(x, y, z, 0);\n});\n\ninputs.click("middle", () => {\n  if (!voxelInteract.target) return;\n  const [x, y, z] = voxelInteract.target;\n  holdingBlockType = world.getVoxelAt(x, y, z);\n});\n\ninputs.click("right", () => {\n  if (!voxelInteract.potential) return;\n  const { voxel } = voxelInteract.potential;\n  world.updateVoxel(...voxel, holdingBlockType);\n});\n\nfunction animate() {\n  requestAnimationFrame(animate);\n\n  if (world.isInitialized) {\n    world.update(\n      camera.getWorldPosition(new THREE.Vector3()),\n      camera.getWorldDirection(new THREE.Vector3())\n    );\n\n    rigidControls.update();\n    voxelInteract.update();\n    perspectives.update();\n    lightShined.update();\n    shadows.update();\n    peers.update();\n  }\n\n  renderer.render(world, camera);\n}\n\nasync function start() {\n  animate();\n\n  await network.connect("http://localhost:4000");\n  await network.join("tutorial");\n\n  await world.initialize();\n\n  world.sky.setShadingPhases([\n    {\n      name: "sunrise",\n      color: {\n        top: new THREE.Color("#7694CF"),\n        middle: new THREE.Color("#B0483A"),\n        bottom: new THREE.Color("#222"),\n      },\n      skyOffset: 0.05,\n      voidOffset: 0.6,\n      start: 0.2,\n    },\n    {\n      name: "daylight",\n      color: {\n        top: new THREE.Color("#73A3FB"),\n        middle: new THREE.Color("#B1CCFD"),\n        bottom: new THREE.Color("#222"),\n      },\n      skyOffset: 0,\n      voidOffset: 0.6,\n      start: 0.25,\n    },\n    {\n      name: "sunset",\n      color: {\n        top: new THREE.Color("#A57A59"),\n        middle: new THREE.Color("#FC5935"),\n        bottom: new THREE.Color("#222"),\n      },\n      skyOffset: 0.05,\n      voidOffset: 0.6,\n      start: 0.7,\n    },\n    {\n      name: "night",\n      color: {\n        top: new THREE.Color("#000"),\n        middle: new THREE.Color("#000"),\n        bottom: new THREE.Color("#000"),\n      },\n      skyOffset: 0.1,\n      voidOffset: 0.6,\n      start: 0.75,\n    },\n  ]);\n\n  world.sky.paint("bottom", VOXELIZE.artFunctions.drawSun());\n  world.sky.paint("top", VOXELIZE.artFunctions.drawStars());\n  world.sky.paint("top", VOXELIZE.artFunctions.drawMoon());\n  world.sky.paint("sides", VOXELIZE.artFunctions.drawStars());\n\n  const allFaces = ["px", "nx", "py", "ny", "pz", "nz"];\n  await world.applyBlockTexture("Dirt", allFaces, "/blocks/dirt.png");\n  await world.applyBlockTexture("Stone", allFaces, "/blocks/stone.png");\n  await world.applyBlockTexture(\n    "Grass Block",\n    ["px", "pz", "nx", "nz"],\n    "/blocks/grass_side.png"\n  );\n  await world.applyBlockTexture("Grass Block", "py", "/blocks/grass_top.png");\n  await world.applyBlockTexture("Grass Block", "ny", "/blocks/dirt.png");\n}\n\nstart();\n'})}),"\n",(0,a.jsxs)(n.p,{children:["This matches the final tutorial repository code. For custom peer metadata (like held items, roles, health), see the ",(0,a.jsx)(n.a,{href:"/wiki/entities/custom-peers",children:"Custom Peers"})," wiki page."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);