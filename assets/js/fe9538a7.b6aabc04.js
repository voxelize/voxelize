"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2611],{18420:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>r});const i=JSON.parse('{"id":"intermediate/method-handling","title":"Method Handling","description":"Methods are world-wide RPC calls from client to server. They\'re used for actions that affect game state, like spawning entities, updating inventories, or changing world settings.","source":"@site/docs/tutorials/intermediate/9-method-handling.md","sourceDirName":"intermediate","slug":"/intermediate/method-handling","permalink":"/tutorials/intermediate/method-handling","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"The Events System","permalink":"/tutorials/intermediate/the-events-system"},"next":{"title":"Chat and Colored Text","permalink":"/tutorials/intermediate/chat-and-colored-text"}}');var s=n(62540),d=n(43023);const l={sidebar_position:9},o="Method Handling",a={},r=[{value:"Client-Side Methods",id:"client-side-methods",level:2},{value:"Setting Up",id:"setting-up",level:3},{value:"Calling Methods",id:"calling-methods",level:3},{value:"With Callbacks",id:"with-callbacks",level:3},{value:"Server-Side Methods",id:"server-side-methods",level:2},{value:"Defining Handlers",id:"defining-handlers",level:3},{value:"Accessing Client Info",id:"accessing-client-info",level:3},{value:"Responding to Methods",id:"responding-to-methods",level:3},{value:"Built-in Methods",id:"built-in-methods",level:2},{value:"Example: Inventory System",id:"example-inventory-system",level:2},{value:"Example: Chat Commands",id:"example-chat-commands",level:2},{value:"Method vs Event",id:"method-vs-event",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"method-handling",children:"Method Handling"})}),"\n",(0,s.jsx)(t.p,{children:"Methods are world-wide RPC calls from client to server. They're used for actions that affect game state, like spawning entities, updating inventories, or changing world settings."}),"\n",(0,s.jsx)(t.h2,{id:"client-side-methods",children:"Client-Side Methods"}),"\n",(0,s.jsx)(t.h3,{id:"setting-up",children:"Setting Up"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Method Setup"',children:'import * as VOXELIZE from "@voxelize/core";\n\nconst method = new VOXELIZE.Method();\n\nnetwork.register(method);\n'})}),"\n",(0,s.jsx)(t.h3,{id:"calling-methods",children:"Calling Methods"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Calling a Method"',children:'method.call("spawn-bot", {\n  position: [10, 80, 10],\n  name: "Bob",\n  personality: "follower",\n});\n'})}),"\n",(0,s.jsx)(t.h3,{id:"with-callbacks",children:"With Callbacks"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Method with Callback"',children:'method.call("get-inventory", { playerId: "player-123" }, (response) => {\n  console.log("Inventory:", response);\n});\n'})}),"\n",(0,s.jsx)(t.h2,{id:"server-side-methods",children:"Server-Side Methods"}),"\n",(0,s.jsx)(t.h3,{id:"defining-handlers",children:"Defining Handlers"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-rust",metastring:'title="Method Handler"',children:'use serde::{Serialize, Deserialize};\n\n#[derive(Deserialize)]\nstruct SpawnBotPayload {\n    position: Vec3<f32>,\n    name: String,\n    personality: String,\n}\n\nworld.set_method_handle("spawn-bot", |world, client_id, payload| {\n    let data: SpawnBotPayload = serde_json::from_str(payload)\n        .expect("Invalid spawn-bot payload");\n\n    let mut metadata = MetadataComp::default();\n    metadata.set("name", &data.name);\n    metadata.set("personality", &data.personality);\n\n    world.spawn_entity_with_metadata("bot", &data.position, metadata);\n});\n'})}),"\n",(0,s.jsx)(t.h3,{id:"accessing-client-info",children:"Accessing Client Info"}),"\n",(0,s.jsx)(t.p,{children:"The handler receives the calling client's ID:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-rust",metastring:'title="Using Client ID"',children:'world.set_method_handle("teleport-home", |world, client_id, _| {\n    let client = world.clients().get(client_id).unwrap();\n    let entity = client.entity;\n\n    let mut positions = world.write_component::<PositionComp>();\n    if let Some(pos) = positions.get_mut(entity) {\n        pos.0.set(0.0, 100.0, 0.0);\n    }\n\n    let mut bodies = world.write_component::<RigidBodyComp>();\n    if let Some(body) = bodies.get_mut(entity) {\n        body.0.set_position(0.0, 100.0, 0.0);\n    }\n});\n'})}),"\n",(0,s.jsx)(t.h3,{id:"responding-to-methods",children:"Responding to Methods"}),"\n",(0,s.jsx)(t.p,{children:"Send a response back to the client:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-rust",metastring:'title="Method Response"',children:'use voxelize::{Message, MessageType, ClientFilter};\n\nworld.set_method_handle("get-stats", |world, client_id, _| {\n    let stats = world.stats().get_stats();\n\n    world.write_resource::<MessageQueue>().push((\n        Message::new(&MessageType::Method)\n            .method("get-stats", &serde_json::to_string(&stats).unwrap())\n            .build(),\n        ClientFilter::Direct(client_id.to_owned()),\n    ));\n});\n'})}),"\n",(0,s.jsx)(t.h2,{id:"built-in-methods",children:"Built-in Methods"}),"\n",(0,s.jsx)(t.p,{children:"Voxelize includes some built-in methods:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Method"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"vox-builtin:get-stats"})}),(0,s.jsx)(t.td,{children:"Get world stats (time, tick count)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"vox-builtin:set-time"})}),(0,s.jsx)(t.td,{children:"Set the world time"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"vox-builtin:update-block-entity"})}),(0,s.jsx)(t.td,{children:"Update block entity JSON data"})]})]})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Using Built-in Methods"',children:'// Set world time to noon\nmethod.call("vox-builtin:set-time", { time: 1200 });\n\n// Get current stats\nmethod.call("vox-builtin:get-stats", {});\n'})}),"\n",(0,s.jsx)(t.h2,{id:"example-inventory-system",children:"Example: Inventory System"}),"\n",(0,s.jsx)(t.p,{children:"Server-side inventory method:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-rust",metastring:'title="Inventory Method"',children:'#[derive(Deserialize)]\nstruct UpdateSlotPayload {\n    slot: usize,\n    item_id: u32,\n    count: u32,\n}\n\nworld.set_method_handle("update-slot", |world, client_id, payload| {\n    let data: UpdateSlotPayload = serde_json::from_str(payload).unwrap();\n\n    let client = world.clients().get(client_id).unwrap();\n    let entity = client.entity;\n\n    let mut inventories = world.write_component::<InventoryComp>();\n    if let Some(inv) = inventories.get_mut(entity) {\n        inv.set_slot(data.slot, data.item_id, data.count);\n    }\n});\n'})}),"\n",(0,s.jsx)(t.p,{children:"Client-side usage:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",metastring:'title="Client Inventory Update"',children:'function setInventorySlot(slot: number, itemId: number, count: number) {\n  method.call("update-slot", { slot, item_id: itemId, count });\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"example-chat-commands",children:"Example: Chat Commands"}),"\n",(0,s.jsx)(t.p,{children:"Handle chat commands via methods:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-rust",metastring:'title="Command Method"',children:'world.set_command_handle(|world, client_id, command| {\n    let parts: Vec<&str> = command.split_whitespace().collect();\n\n    match parts.get(0) {\n        Some(&"spawn") => {\n            if let Some(&entity_type) = parts.get(1) {\n                // Get player position\n                let client = world.clients().get(client_id).unwrap();\n                let pos = world.read_component::<PositionComp>()\n                    .get(client.entity)\n                    .unwrap()\n                    .0\n                    .clone();\n\n                world.spawn_entity_at(entity_type, &pos);\n            }\n        }\n        Some(&"time") => {\n            if let Some(time_str) = parts.get(1) {\n                if let Ok(time) = time_str.parse::<f32>() {\n                    world.stats_mut().set_time(time);\n                }\n            }\n        }\n        _ => {}\n    }\n});\n'})}),"\n",(0,s.jsx)(t.h2,{id:"method-vs-event",children:"Method vs Event"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Feature"}),(0,s.jsx)(t.th,{children:"Method"}),(0,s.jsx)(t.th,{children:"Event"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Direction"}),(0,s.jsx)(t.td,{children:"Client \u2192 Server"}),(0,s.jsx)(t.td,{children:"Bidirectional"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Scope"}),(0,s.jsx)(t.td,{children:"World-wide"}),(0,s.jsx)(t.td,{children:"Location-based"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Handler required"}),(0,s.jsx)(t.td,{children:"Yes"}),(0,s.jsx)(t.td,{children:"No (broadcasts by default)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Use case"}),(0,s.jsx)(t.td,{children:"State changes"}),(0,s.jsx)(t.td,{children:"Visual effects, notifications"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["Read on to learn about ",(0,s.jsx)(t.a,{href:"./chat-and-colored-text",children:"chat and colored text"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,d.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},43023:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var i=n(63696);const s={},d=i.createContext(s);function l(e){const t=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(d.Provider,{value:t},e.children)}}}]);