"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3575],{24332:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"intermediate/the-events-system","title":"The Events System","description":"Events are location-based messages that broadcast to nearby clients. Unlike methods which are world-wide RPC calls, events only reach clients who have the originating chunk loaded.","source":"@site/docs/tutorials/intermediate/8-the-events-system.md","sourceDirName":"intermediate","slug":"/intermediate/the-events-system","permalink":"/tutorials/intermediate/the-events-system","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"Collision Detection","permalink":"/tutorials/intermediate/collision-detection"},"next":{"title":"Method Handling","permalink":"/tutorials/intermediate/method-handling"}}');var i=t(62540),a=t(43023);const l={sidebar_position:8},r="The Events System",d={},o=[{value:"How Events Work",id:"how-events-work",level:2},{value:"Client-Side Events",id:"client-side-events",level:2},{value:"Setting Up",id:"setting-up",level:3},{value:"Emitting Events",id:"emitting-events",level:3},{value:"Listening for Events",id:"listening-for-events",level:3},{value:"Removing Listeners",id:"removing-listeners",level:3},{value:"Server-Side Events",id:"server-side-events",level:2},{value:"Handling Events",id:"handling-events",level:3},{value:"Dispatching Events",id:"dispatching-events",level:3},{value:"Broadcast to All",id:"broadcast-to-all",level:3},{value:"Event vs Method",id:"event-vs-method",level:2},{value:"Example: Hit Effect",id:"example-hit-effect",level:2},{value:"Example: Block Break Effect",id:"example-block-break-effect",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"the-events-system",children:"The Events System"})}),"\n",(0,i.jsx)(n.p,{children:"Events are location-based messages that broadcast to nearby clients. Unlike methods which are world-wide RPC calls, events only reach clients who have the originating chunk loaded."}),"\n",(0,i.jsx)(n.h2,{id:"how-events-work",children:"How Events Work"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Client emits an event"}),"\n",(0,i.jsx)(n.li,{children:"Server receives and determines the client's current chunk"}),"\n",(0,i.jsx)(n.li,{children:"Event broadcasts to all clients with that chunk loaded"}),"\n",(0,i.jsx)(n.li,{children:"Or, server can handle the event with a custom handler"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"client-side-events",children:"Client-Side Events"}),"\n",(0,i.jsx)(n.h3,{id:"setting-up",children:"Setting Up"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Events Setup"',children:'import * as VOXELIZE from "@voxelize/core";\n\nconst events = new VOXELIZE.Events();\n\nnetwork.register(events);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"emitting-events",children:"Emitting Events"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Emitting an Event"',children:'events.emit("attack", {\n  targetId: "enemy-123",\n  damage: 10,\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"listening-for-events",children:"Listening for Events"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Listening for Events"',children:'events.on("explosion", (payload) => {\n  const { position, radius } = payload;\n  createExplosionEffect(position, radius);\n});\n\nevents.on("player-hit", (payload) => {\n  const { playerId, damage } = payload;\n  showDamageIndicator(playerId, damage);\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"removing-listeners",children:"Removing Listeners"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Removing Listeners"',children:'const handler = (payload: any) => {\n  console.log(payload);\n};\n\nevents.on("my-event", handler);\nevents.off("my-event", handler);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"server-side-events",children:"Server-Side Events"}),"\n",(0,i.jsx)(n.h3,{id:"handling-events",children:"Handling Events"}),"\n",(0,i.jsx)(n.p,{children:"Handle events on the server instead of broadcasting:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:'title="Server Event Handler"',children:'#[derive(Serialize, Deserialize)]\nstruct AttackPayload {\n    target_id: String,\n    damage: i32,\n}\n\nworld.set_event_handle("attack", |world, client_id, payload| {\n    let data: AttackPayload = serde_json::from_str(payload)\n        .expect("Invalid attack payload");\n\n    // Process the attack\n    // Find target entity and apply damage\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"dispatching-events",children:"Dispatching Events"}),"\n",(0,i.jsx)(n.p,{children:"Dispatch events from the server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:'title="Dispatching Events"',children:'use voxelize::{Event, Vec2};\n\nworld.events_mut().dispatch(\n    Event::new("explosion")\n        .payload(serde_json::json!({\n            "position": [10.0, 64.0, 10.0],\n            "radius": 5.0,\n        }))\n        .location(Vec2(0, 0))  // Chunk coordinates\n        .build()\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"broadcast-to-all",children:"Broadcast to All"}),"\n",(0,i.jsx)(n.p,{children:"To broadcast to all clients regardless of location:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:'title="Broadcasting to All"',children:'world.events_mut().dispatch(\n    Event::new("server-announcement")\n        .payload(serde_json::json!({\n            "message": "Server restarting in 5 minutes",\n        }))\n        .build()\n);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"event-vs-method",children:"Event vs Method"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Event"}),(0,i.jsx)(n.th,{children:"Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Scope"}),(0,i.jsx)(n.td,{children:"Location-based"}),(0,i.jsx)(n.td,{children:"World-wide"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Default behavior"}),(0,i.jsx)(n.td,{children:"Broadcast to nearby"}),(0,i.jsx)(n.td,{children:"Requires handler"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Use case"}),(0,i.jsx)(n.td,{children:"Visual effects, local actions"}),(0,i.jsx)(n.td,{children:"State changes, RPCs"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"example-hit-effect",children:"Example: Hit Effect"}),"\n",(0,i.jsx)(n.p,{children:"Client emits hit event:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Client Hit Event"',children:'function onPlayerHit(targetId: string) {\n  events.emit("player-hit", {\n    targetId,\n    attackerId: network.clientId,\n  });\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Server processes and broadcasts:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:'title="Server Hit Handler"',children:'world.set_event_handle("player-hit", |world, client_id, payload| {\n    let data: HitPayload = serde_json::from_str(payload).unwrap();\n\n    // Apply damage to target\n    // ...\n\n    // Get attacker position for effect location\n    let client = world.clients().get(client_id).unwrap();\n    let pos = world.read_component::<PositionComp>()\n        .get(client.entity)\n        .unwrap();\n\n    // Broadcast hit effect to nearby players\n    let chunk = world.read_component::<CurrentChunkComp>()\n        .get(client.entity)\n        .unwrap()\n        .coords\n        .clone();\n\n    world.events_mut().dispatch(\n        Event::new("hit-effect")\n            .payload(serde_json::json!({\n                "position": [pos.0.0, pos.0.1, pos.0.2],\n                "targetId": data.target_id,\n            }))\n            .location(chunk)\n            .build()\n    );\n});\n'})}),"\n",(0,i.jsx)(n.p,{children:"Client renders effect:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Client Hit Effect"',children:'events.on("hit-effect", (payload) => {\n  const { position, targetId } = payload;\n  playHitSound(position);\n  showHitParticles(position);\n});\n'})}),"\n",(0,i.jsx)(n.h2,{id:"example-block-break-effect",children:"Example: Block Break Effect"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Block Break Event"',children:'events.on("block-break", (payload) => {\n  const { voxel, blockId } = payload;\n  const [vx, vy, vz] = voxel;\n\n  const particles = createBlockParticles(blockId);\n  particles.position.set(vx + 0.5, vy + 0.5, vz + 0.5);\n  world.add(particles);\n\n  setTimeout(() => {\n    world.remove(particles);\n  }, 1000);\n});\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Read on to learn about ",(0,i.jsx)(n.a,{href:"./method-handling",children:"method handling"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},43023:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var s=t(63696);const i={},a=s.createContext(i);function l(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);