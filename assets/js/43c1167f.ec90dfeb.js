"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8502],{4841:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/block-placements-b8a046581021a67549777dd7a2fb2a48.png"},22116:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"basics/update-voxels","title":"Update Voxels","description":"To modify voxels, we need to know which block the player is looking at. Voxelize uses a fast ray-voxel intersection algorithm based on this paper.","source":"@site/docs/tutorials/basics/12-update-voxels.md","sourceDirName":"basics","slug":"/basics/update-voxels","permalink":"/tutorials/basics/update-voxels","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"Debug Voxelize","permalink":"/tutorials/basics/debug-ui"},"next":{"title":"Set Perspectives","permalink":"/tutorials/basics/perspectives-and-visuals"}}');var a=t(62540),r=t(43023);const o={sidebar_position:12},s="Update Voxels",l={},c=[{value:"Setting Up Voxel Interaction",id:"setting-up-voxel-interaction",level:2},{value:"Breaking Blocks",id:"breaking-blocks",level:2},{value:"Placing Blocks",id:"placing-blocks",level:2},{value:"Full Implementation",id:"full-implementation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"update-voxels",children:"Update Voxels"})}),"\n",(0,a.jsxs)(n.p,{children:["To modify voxels, we need to know which block the player is looking at. Voxelize uses a fast ray-voxel intersection algorithm based on ",(0,a.jsx)(n.a,{href:"http://www.cse.yorku.ca/~amana/research/grid.pdf",children:"this paper"}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(94748).A+"",width:"501",height:"223"})}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-voxel-interaction",children:"Setting Up Voxel Interaction"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:'const voxelInteract = new VOXELIZE.VoxelInteract(camera, world, {\n  highlightType: "outline",\n});\n\nworld.add(voxelInteract);\n'})}),"\n",(0,a.jsx)(n.p,{children:"Add the update call to your animation loop:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"function animate() {\n  if (world.isInitialized) {\n    voxelInteract.update();\n  }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Add a crosshair to your HTML:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",metastring:'title="index.html"',children:'<div id="app">\n  <canvas id="canvas"></canvas>\n  <div id="crosshair"></div>\n</div>\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-css",metastring:'title="style.css"',children:"#crosshair {\n  width: 12px;\n  height: 12px;\n  border: 2px solid #fff3;\n  border-radius: 6px;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(63798).A+"",width:"2560",height:"1440"})}),"\n",(0,a.jsx)(n.h2,{id:"breaking-blocks",children:"Breaking Blocks"}),"\n",(0,a.jsxs)(n.p,{children:["Use ",(0,a.jsx)(n.code,{children:"world.updateVoxel"})," to set a voxel to type 0 (air):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:'inputs.click("left", () => {\n  if (!voxelInteract.target) return;\n\n  const [x, y, z] = voxelInteract.target;\n  world.updateVoxel(x, y, z, 0);\n});\n'})}),"\n",(0,a.jsx)(n.h2,{id:"placing-blocks",children:"Placing Blocks"}),"\n",(0,a.jsxs)(n.p,{children:["Use ",(0,a.jsx)(n.code,{children:"voxelInteract.potential"})," for the position adjacent to the targeted face:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:'let holdingBlockType = 1;\n\ninputs.click("middle", () => {\n  if (!voxelInteract.target) return;\n\n  const [x, y, z] = voxelInteract.target;\n  holdingBlockType = world.getVoxelAt(x, y, z);\n});\n\ninputs.click("right", () => {\n  if (!voxelInteract.potential) return;\n\n  const { voxel } = voxelInteract.potential;\n  world.updateVoxel(...voxel, holdingBlockType);\n});\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(4841).A+"",width:"2560",height:"1440"})}),"\n",(0,a.jsx)(n.p,{children:"Left click breaks, middle click picks the block type, right click places."}),"\n",(0,a.jsx)(n.h2,{id:"full-implementation",children:"Full Implementation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:'import * as VOXELIZE from "@voxelize/core";\nimport * as THREE from "three";\n\nconst canvas = document.getElementById("canvas");\n\nconst world = new VOXELIZE.World({\n  textureUnitDimension: 16,\n});\n\nconst camera = new THREE.PerspectiveCamera(\n  75,\n  window.innerWidth / window.innerHeight,\n  0.1,\n  3000\n);\n\nconst renderer = new THREE.WebGLRenderer({\n  antialias: true,\n  powerPreference: "high-performance",\n  canvas,\n});\nrenderer.setSize(window.innerWidth, window.innerHeight);\nrenderer.setPixelRatio(window.devicePixelRatio || 1);\nrenderer.outputColorSpace = THREE.SRGBColorSpace;\n\nconst network = new VOXELIZE.Network();\nnetwork.register(world);\n\nconst inputs = new VOXELIZE.Inputs();\n\nconst rigidControls = new VOXELIZE.RigidControls(\n  camera,\n  renderer.domElement,\n  world,\n  { initialPosition: [0, 40, 0] }\n);\nrigidControls.connect(inputs);\n\nconst voxelInteract = new VOXELIZE.VoxelInteract(camera, world, {\n  highlightType: "outline",\n});\nworld.add(voxelInteract);\n\nlet holdingBlockType = 1;\n\ninputs.click("left", () => {\n  if (!voxelInteract.target) return;\n  const [x, y, z] = voxelInteract.target;\n  world.updateVoxel(x, y, z, 0);\n});\n\ninputs.click("middle", () => {\n  if (!voxelInteract.target) return;\n  const [x, y, z] = voxelInteract.target;\n  holdingBlockType = world.getVoxelAt(x, y, z);\n});\n\ninputs.click("right", () => {\n  if (!voxelInteract.potential) return;\n  const { voxel } = voxelInteract.potential;\n  world.updateVoxel(...voxel, holdingBlockType);\n});\n\nfunction animate() {\n  requestAnimationFrame(animate);\n\n  if (world.isInitialized) {\n    rigidControls.update();\n    voxelInteract.update();\n    world.update(\n      camera.getWorldPosition(new THREE.Vector3()),\n      camera.getWorldDirection(new THREE.Vector3())\n    );\n  }\n\n  renderer.render(world, camera);\n}\n\nasync function start() {\n  animate();\n\n  await network.connect("http://localhost:4000");\n  await network.join("tutorial");\n\n  await world.initialize();\n}\n\nstart();\n'})}),"\n",(0,a.jsxs)(n.p,{children:["For bulk voxel updates and radius-based operations, see ",(0,a.jsx)(n.code,{children:"examples/client/src/main.ts"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},43023:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var i=t(63696);const a={},r=i.createContext(a);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},63798:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/voxel-interact-1f2489de90f51a954a806ef2ed8d0f07.png"},94748:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/raycast-8c7b421be865967f053f189c73bc1cf6.png"}}]);