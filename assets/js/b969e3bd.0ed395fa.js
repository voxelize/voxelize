"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3925],{43023:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var s=t(63696);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},85948:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"entities/custom-peers","title":"Custom Peers","description":"Peers represent other players in the world. You can customize peer rendering by extending the Peers class and using mixins.","source":"@site/docs/wiki/entities/custom-peers.md","sourceDirName":"entities","slug":"/entities/custom-peers","permalink":"/wiki/entities/custom-peers","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Custom Entities","permalink":"/wiki/entities/custom-entities"}}');var i=t(62540),r=t(43023);const a={sidebar_position:2},l="Custom Peers",d={},o=[{value:"The Peer Class",id:"the-peer-class",level:2},{value:"The Peers Manager",id:"the-peers-manager",level:2},{value:"Mixins for Extra Features",id:"mixins-for-extra-features",level:2},{value:"Holding Objects",id:"holding-objects",level:3},{value:"Hit Effects",id:"hit-effects",level:3},{value:"Combined Mixins",id:"combined-mixins",level:3},{value:"Peer Groups",id:"peer-groups",level:2},{value:"Server-Side Peer Data",id:"server-side-peer-data",level:2},{value:"Client Parser",id:"client-parser",level:3},{value:"Client Modifier",id:"client-modifier",level:3},{value:"Sending Custom Peer Data",id:"sending-custom-peer-data",level:2},{value:"Client Side",id:"client-side",level:3},{value:"Server Side",id:"server-side",level:3},{value:"Role-Based Styling",id:"role-based-styling",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"custom-peers",children:"Custom Peers"})}),"\n",(0,i.jsxs)(n.p,{children:["Peers represent other players in the world. You can customize peer rendering by extending the ",(0,i.jsx)(n.code,{children:"Peers"})," class and using mixins."]}),"\n",(0,i.jsx)(n.h2,{id:"the-peer-class",children:"The Peer Class"}),"\n",(0,i.jsxs)(n.p,{children:["The default peer uses ",(0,i.jsx)(n.code,{children:"VOXELIZE.Character"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Basic Peer"',children:'import * as VOXELIZE from "@voxelize/core";\n\nclass Peer extends VOXELIZE.Character {\n  constructor() {\n    super({\n      nameTagOptions: {\n        fontFace: "monospace",\n        yOffset: 0.2,\n      },\n    });\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"the-peers-manager",children:"The Peers Manager"}),"\n",(0,i.jsxs)(n.p,{children:["Extend ",(0,i.jsx)(n.code,{children:"VOXELIZE.Peers"})," to customize peer creation and updates:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Custom Peers Manager"',children:'import * as VOXELIZE from "@voxelize/core";\n\ntype PeersMeta = {\n  position: VOXELIZE.Coords3;\n  direction: number[];\n  role?: string;\n  holdingObjectId?: number;\n};\n\nclass Peers extends VOXELIZE.Peers<Peer, PeersMeta> {\n  createPeer = (id: string): Peer => {\n    const peer = new Peer();\n    peer.userData.id = id;\n    return peer;\n  };\n\n  onPeerUpdate = (\n    peer: Peer,\n    metadata: PeersMeta,\n    info: { username: string }\n  ) => {\n    peer.set(metadata.position, metadata.direction);\n    peer.username = info.username;\n  };\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"mixins-for-extra-features",children:"Mixins for Extra Features"}),"\n",(0,i.jsx)(n.h3,{id:"holding-objects",children:"Holding Objects"}),"\n",(0,i.jsx)(n.p,{children:"Add the ability for peers to hold items:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Holding Mixin"',children:'export const HoldingMixin = <\n  T extends new (...args: any[]) => VOXELIZE.Character\n>(\n  Base: T\n) => {\n  return class extends Base {\n    public holdingObjectId = 0;\n\n    setHoldingObjectId = (id: number, world?: VOXELIZE.World) => {\n      if (id === this.holdingObjectId) return;\n\n      if (id === 0) {\n        this.setArmHoldingObject(undefined);\n      } else {\n        const mesh = world?.makeBlockMesh(id, { material: "basic" });\n        this.setArmHoldingObject(mesh);\n      }\n\n      this.holdingObjectId = id;\n    };\n  };\n};\n\nclass Peer extends HoldingMixin(VOXELIZE.Character) {}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"hit-effects",children:"Hit Effects"}),"\n",(0,i.jsx)(n.p,{children:"Add visual feedback when a peer is hit:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Hittable Mixin"',children:"export const HittableMixin = <\n  T extends new (...args: any[]) => VOXELIZE.Character\n>(\n  Base: T\n) => {\n  return class extends Base {\n    private hitTimeout: number | null = null;\n\n    hit = () => {\n      this.head.children.forEach((child) => {\n        if (child instanceof THREE.Mesh) {\n          (child.material as THREE.MeshBasicMaterial).color.setHex(0xff0000);\n        }\n      });\n\n      if (this.hitTimeout) clearTimeout(this.hitTimeout);\n\n      this.hitTimeout = window.setTimeout(() => {\n        this.head.children.forEach((child) => {\n          if (child instanceof THREE.Mesh) {\n            (child.material as THREE.MeshBasicMaterial).color.setHex(0xffffff);\n          }\n        });\n      }, 300);\n    };\n  };\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"combined-mixins",children:"Combined Mixins"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Combined Peer"',children:'class Peer extends HittableMixin(HoldingMixin(VOXELIZE.Character)) {\n  public role = "player";\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"peer-groups",children:"Peer Groups"}),"\n",(0,i.jsx)(n.p,{children:"Organize peers into groups:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Peer Groups"',children:"class Peers extends VOXELIZE.Peers<Peer, PeersMeta> {\n  public players = new THREE.Group();\n  public spectators = new THREE.Group();\n\n  createPeer = (id: string): Peer => {\n    const peer = new Peer();\n    this.players.add(peer);\n    return peer;\n  };\n\n  onPeerUpdate = (peer: Peer, metadata: PeersMeta) => {\n    if (metadata.isSpectator) {\n      this.players.remove(peer);\n      this.spectators.add(peer);\n      peer.visible = false;\n    } else {\n      this.spectators.remove(peer);\n      this.players.add(peer);\n      peer.visible = true;\n    }\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"server-side-peer-data",children:"Server-Side Peer Data"}),"\n",(0,i.jsx)(n.h3,{id:"client-parser",children:"Client Parser"}),"\n",(0,i.jsx)(n.p,{children:"Parse incoming peer data on the server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:'title="Client Parser"',children:"world.set_client_parser(|world, metadata_str, client_ent| {\n    #[derive(Deserialize)]\n    struct PeerUpdate {\n        position: Option<Vec3<f32>>,\n        direction: Option<Vec3<f32>>,\n    }\n\n    let metadata: PeerUpdate = serde_json::from_str(metadata_str).unwrap();\n\n    if let Some(pos) = metadata.position {\n        let mut positions = world.write_component::<PositionComp>();\n        if let Some(p) = positions.get_mut(client_ent) {\n            p.0.set(pos.0, pos.1, pos.2);\n        }\n    }\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"client-modifier",children:"Client Modifier"}),"\n",(0,i.jsx)(n.p,{children:"Add components to new clients:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",metastring:'title="Client Modifier"',children:'world.set_client_modifier(|world, entity| {\n    world.add(entity, RoleComp::new("player"));\n    world.add(entity, InventoryComp::new(36));\n});\n'})}),"\n",(0,i.jsx)(n.h2,{id:"sending-custom-peer-data",children:"Sending Custom Peer Data"}),"\n",(0,i.jsx)(n.h3,{id:"client-side",children:"Client Side"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Client Peer Data"',children:"class Peers extends VOXELIZE.Peers<Peer, PeersMeta> {\n  packInfo = () => {\n    return {\n      id: this.ownID,\n      username: this.ownUsername,\n      metadata: {\n        position: this.getPosition(),\n        direction: this.getDirection(),\n        role: this.ownPeer?.role,\n        holdingObjectId: this.ownPeer?.holdingObjectId,\n      },\n    };\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"server-side",children:"Server Side"}),"\n",(0,i.jsxs)(n.p,{children:["Custom metadata is synced via ",(0,i.jsx)(n.code,{children:"PeersMetaSystem"})," or custom systems."]}),"\n",(0,i.jsx)(n.h2,{id:"role-based-styling",children:"Role-Based Styling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:'title="Role Colors"',children:'const roleColors: Record<string, number> = {\n  admin: 0xff0000,\n  mod: 0x00ff00,\n  player: 0xffffff,\n};\n\nonPeerUpdate = (peer: Peer, metadata: PeersMeta) => {\n  const color = roleColors[metadata.role || "player"];\n  peer.head.children.forEach((child) => {\n    if (child instanceof THREE.Mesh) {\n      (child.material as THREE.MeshBasicMaterial).color.setHex(color);\n    }\n  });\n};\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);